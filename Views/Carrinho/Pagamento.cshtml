<link rel="stylesheet" type="text/css" href="~/assets/css/Carrinho/pagamento.css" />
@model kuarasy.Models.Entidades.Compra
@{
    ViewData["Title"] = "Pagamento";
}

<div class="container my-5">
    <main role="main" class="flex-shrink-0">
        <h2 class="fw-bolder"> Finalização do pedido</h2>
        <form  asp-action="Pagamento" method="post" id="formPagamento" class="needs-validation row g-3">
            <div class="col my-5">
                <div class="card">
                    <div class="card-body px-5">
                        <h5 class="card-title my-4">Endereço de entrega</h5>
                            <div class="row justify-content-center">
                            <div > 
                                <div>
                                    <input type="text" class="form-control mb-0" id="cep" placeholder="CEP" data-js="cep" name="cep" required>
                                    <span class="my-2 error"></span>
                                </div>
                                <input type="text" class="form-control mt-3 mb-4" id="endereco" name="logradouro" placeholder="Endereço" required>
                                <input type="text" class="form-control mb-4" id="bairro" name="bairro" placeholder="Bairro" required>
                                <input type="text" class="form-control mb-4" id="numero" placeholder="Numero" required>
                            </div>

                            <!-- <div class="d-flex justify-content-end" >
                                <button type="button" class="btn btn-red mb-3" id="searchCEP" value="" disabled> Salvar</button>
                            </div> -->
                        </div>
                      
                    </div>

                </div>

                <div class="card my-5 bg-red-medium text-light shadow" >
                    <div class="card-body ms-4">
                        <div class="table-responsive">
                            <table class="table table-borderless my-3">
                                <thead>
                                    <tr class="text-light">
                                        <th>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" aria-describedby="checkHelp1" checked>
                                                <label class="form-check-label fw-bolder text-light" for="flexRadioDefault1">
                                                    Frete Fixo
                                                </label>
                                                <div id="checkHelp1" class="form-text text-light">No minímo 15 dias úteis para envio</div>
                                            </div>
                                            
                                        </th>
                                    
                                        <th class="align-top ">R$30,00</th>  
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>

                </div>  
                <div class="card my-5 bg-red-medium-white text-light shadow" >
                    <div class="card-body ms-4 text-center">
                        <h3 id="TotalPreco" class = "text-dark"> </h3>  
                    </div>
                </div>  
                          
            </div>

            
            <div class="col my-5 ms-4">
                <div class="row card mb-5">
                    <div class="card-body px-5">
                        <h5 class="card-title my-4"> Informações pessoais</h5>
                        <div class="row">
                            <span class="d-flex">Contato: <p class="ms-2 text-muted"> usuario@email.com</p> </span>
                            <span class="d-flex">Nome: <p class="ms-2 text-muted"> Usuario Sobrenome</p> </span>
                            <span class="d-flex">CPF: <p class="ms-2  text-muted"> 456.789.123-00</p> </span>
                            <span class="d-flex">Telefone: <p class="ms-2 text-muted"> (11) 99999-9999</p></span>
                        </div>
                    </div>
                </div>

                    <div class="card row">
                        <div class="card-body px-5">
                            <h5 class="card-title my-4"> Pagamento</h5>
                                <div class="row mb-3">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label for="name">Nome do titular</label>
                                            <input class="form-control my-2" id="name" type="text" placeholder="FULANO A SILVA" required>
                                            <span class="error"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label for="cc">Número do cartão</label>
                                            <div class="input-group my-2">
                                                <input class="form-control" type="text" placeholder="0000 0000 0000 0000" autocomplete="off" id="cc" name="creditcard" required>
                                                <div class="input-group-append">
                                                    <span class="input-group-text" style="font-size:1.5rem;" ><i class="fas fa-credit-card"></i></span>
                                                </div>
                                                <span class="error"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            <div class="row mb-3">
                                <div class="form-group col-sm-4">
                                    <label for="ccmonth">Mês</label>
                                    <select class="form-control my-2" id="ccmonth">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                        <option>6</option>
                                        <option>7</option>
                                        <option>8</option>
                                        <option>9</option>
                                        <option>10</option>
                                        <option>11</option>
                                        <option selected>12</option>
                                    </select>
                                </div>
                                <div class="form-group col-sm-4">
                                    <label for="ccyear">Ano</label>
                                    <select class="form-control my-2" id="ccyear">
                                        <option>2022</option>
                                        <option selected>2023</option>
                                        <option>2024</option>
                                        <option>2025</option>
                                        <option>2026</option>
                                        <option>2027</option>
                                        <option>2028</option>
                                        <option>2029</option>
                                        <option>2030</option>
                                        <option>2031</option>
                                        <option>2032</option>
                                    </select>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label for="cvv">CVV/CVC</label>
                                        <input class="form-control my-2" id="cvv" type="text" placeholder="123"  name="cvv" required>
                                        <span class="error"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
                    
            </div>

            <div class="d-flex justify-content-between align-items-center my-3">
                <div>
                    <a class="btn btn-yellow" asp-area="" asp-controller="Carrinho" asp-action="Index"> Voltar</a>
                </div>
               
                    <div hidden class = "d-none">
                        <textarea asp-for="Observacao" id="nome" class="form-control"></textarea>
                        <input asp-for="Valor_total" id="total"  class="form-control"/>
                        <input asp-for="QuantidadeComprado" id="quantidadeComprado" class="form-control" />
                        <input asp-for="Quantidade" id="quantidade" class="form-control" />
                        <input asp-for="Id_produtos" id="idProduto" class="form-control" />
                    </div>
                     <div class="row my-3" id="verify">
                        <button id="Confirmar" class="btn bg-yellow text-light mb-3 px-3 rounded-3 fw-bolder shadow" type="submit" data-bs-toggle="modal" data-bs-target="#pedidoModal" disabled> Fazer pedido</button>
                    </div>  
               
            </div>

        </form>
  
    </main>

    <!-- Modal -->
    <div class="modal fade" id="pedidoModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="pedidoModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

            </div>
        </div>
    </div>
</div>



<script>
    const Storage = {
		get() {
			return JSON.parse(localStorage.getItem("Carrinho")) || []
		},
		set(produtos) {
			localStorage.setItem("Carrinho", JSON.stringify(produtos))
		}
	}
    const Produto = {
        all: Storage.get(),
        inserir(){
            Produto.all.forEach(produto => {
                document.getElementById('nome').value += produto.nome+": "+produto.quantidadePadrao+"\n"
                document.getElementById('total').value = Utils.formatCurrency(Produto.total())
                document.getElementById('TotalPreco').innerHTML = "Total a pagar: "+Utils.formatCurrency(Produto.total()+3000)
                document.getElementById('quantidadeComprado').value += produto.quantidadePadrao+","
                document.getElementById('idProduto').value += produto.id+","
                document.getElementById('quantidade').value += produto.quantidade+","       
			})
        },
        total() {
			let expense = 0
			Produto.all.forEach(produto => {
			expense += produto.preco 
			})
			    return expense  
		}
    }
    const Utils = {
		formatCurrency(value) {
			value = String(value).replace(",", "")
			value = Number(value) / 100
			value = value.toLocaleString("pt-BR", {
				style: "currency",
				currency: "BRL"
			})
			return value
		},
	}

    Produto.inserir()
</script>

<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script type="text/javascript" language="javascript" src="~/assets/js/Carrinho/pagamento.js"></script>
<script type="text/javascript" language="javascript" src="~/assets/js/Carrinho/validacao.js"></script>

<script type="text/javascript" language="javascript" src="~/assets/js/Carrinho/cepAPI.js"></script>


